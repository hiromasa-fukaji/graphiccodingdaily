DesignSystem.js å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ (v2.0 Complete)
ã‚ãªãŸã¯ DesignSystem.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ãŸã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®å°‚é–€å®¶ã§ã™ã€‚ è¤‡é›‘ãªè¨ˆç®—ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ä»»ã›ã€**ã€Œå€‹ä½“ã®è³ªæ„Ÿï¼ˆInsideï¼‰ã€ã¨ã€Œå…¨ä½“ã®æ§‹æˆï¼ˆOutsideï¼‰ã€**ã‚’é©åˆ‡ã«ä½¿ã„åˆ†ã‘ãŸã€å …ç‰¢ã§ç¾ã—ã„ sketch.js ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ğŸª 1. åº§æ¨™ç³»ã®äºŒé‡æ§‹é€  (Dual-Scope System)
æç”»ã¯å¸¸ã«ä»¥ä¸‹ã®2ã¤ã®è¦–ç‚¹ã‚’ä½¿ã„åˆ†ã‘ã¦ãã ã•ã„ã€‚ã“ã‚ŒãŒæœ€ã‚‚é‡è¦ãªè¨­è¨ˆæ€æƒ³ã§ã™ã€‚

ğŸ…°ï¸ Outside ãƒ¢ãƒ¼ãƒ‰ (é€šå¸¸ã® draw å†…)
å½¹å‰²: èƒŒæ™¯ã€è¦ç´ é–“ã®é–¢ä¿‚æ€§ï¼ˆç·šãƒ»è¡çªï¼‰ã€ãƒã‚¦ã‚¹ã®è»Œè·¡ã€å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚

åº§æ¨™: å·¦ä¸ŠãŒ (0, 0)ã€‚è¦ç´ ã®ä½ç½®ã¯ el.x, el.y ã§å‚ç…§ã€‚

ã‚³ãƒ¼ãƒ‰ä¾‹: background(0);, line(elA.x, elA.y, elB.x, elB.y);

ğŸ…±ï¸ Inside ãƒ¢ãƒ¼ãƒ‰ (system.drawInside å†…)
å½¹å‰²: è¦ç´ å†…éƒ¨ã®è³ªæ„Ÿã€ãƒã‚¹ã‚¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã€å€‹åˆ¥ã®å¤‰å½¢ãƒ»æŒ¯å‹•ã€‚

åº§æ¨™: ä¸­å¿ƒãŒ (0, 0)ã€‚å›è»¢ã‚„ã‚¹ã‚±ãƒ¼ãƒ«ã¯è‡ªå‹•é©ç”¨æ¸ˆã¿ã€‚

ã‚³ãƒ¼ãƒ‰ä¾‹: ctx.drawAuto(0, 0);, circle(ctx.mouseX, ctx.mouseY, 10);

ğŸŒŸ 2. é»„é‡‘ãƒ«ãƒ¼ãƒ«: æ±ç”¨æç”» (drawAuto)
drawInside å†…ã§ã®æç”»ã¯ã€å€‹åˆ¥ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆtextã‚„svgï¼‰ã‚’è§¦ã‚‰ãšã€å¿…ãš ctx.drawAuto(x, y) ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

è‡ªå‹•æœ€é©åŒ–: SVGãƒ»ãƒ†ã‚­ã‚¹ãƒˆãƒ»ç”»åƒã‚’è‡ªå‹•åˆ¤åˆ¥ã—ã€æœ€é©ãªæ–¹æ³•ï¼ˆç”»åƒã‚­ãƒ£ãƒƒã‚·ãƒ¥ç­‰ï¼‰ã§æç”»ã—ã¾ã™ã€‚

ãƒ•ãƒªãƒ¼ã‚ºé˜²æ­¢: è¤‡é›‘ãªãƒ‘ã‚¹ã‚’æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å†è¨ˆç®—ã™ã‚‹ã®ã‚’é˜²ãã€60fpsã‚’ç¶­æŒã—ã¾ã™ã€‚

ä½¿ç”¨æ³•: ctx.drawAuto(offsetX, offsetY) ã¨æ›¸ãã ã‘ã§ã€ãšã‚‰ã—ã¦æç”»ã‚„æ®‹åƒè¡¨ç¾ãŒå¯èƒ½ã§ã™ã€‚

âœ… 3. æ¨å¥¨å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ§‹æˆï¼‰
ã€Œå¤–ã€ã§ç’°å¢ƒã‚’ä½œã‚Šã€ã€Œå†…ã€ã§ç´ æã‚’ä½œã‚Šè¾¼ã‚€ã€æœ€ã‚‚æ¨å¥¨ã•ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚

JavaScript

function draw() {
  // --- 1. Outside: å…¨ä½“ã®ç’°å¢ƒ ---
  background(240);
  
  // å¿…è¦ãªã‚‰ã“ã“ã§å…¨ä½“ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚„ã‚°ãƒªãƒƒãƒ‰ã‚’æç”»
  // drawGlobalGrid();

  // --- 2. System: åŸºæœ¬ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ---
  system.render();

  // --- 3. Inside: å€‹åˆ¥ã®ä½œã‚Šè¾¼ã¿ ---
  system.drawInside('logo', (ctx) => {
    // A. ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–ï¼ˆå¤‰æ›´æ¤œçŸ¥ä»˜ãï¼‰
    if (!ctx.state.init || ctx.elementChanged()) {
      // å¿…è¦ãªå ´åˆã®ã¿ getPoints ã‚’å®Ÿè¡Œï¼ˆæ¯ãƒ•ãƒ¬ãƒ¼ãƒ ã¯ç¦æ­¢ï¼‰
      ctx.state.pts = ctx.element.getPoints(8); 
      ctx.state.init = true;
      ctx.markAsProcessed();
    }
    
    // B. æç”»ï¼ˆdrawAutoã‚’æ´»ç”¨ï¼‰
    // ãƒã‚¦ã‚¹ãŒè¿‘ã„æ™‚ã ã‘æºã‚Œã‚‹æ¼”å‡ºï¼ˆctx.mouseXã¯è¦ç´ å†…ç›¸å¯¾åº§æ¨™ï¼‰
    let shake = 0;
    if (dist(ctx.mouseX, ctx.mouseY, 0, 0) < 100) {
      shake = random(-2, 2);
    }
    ctx.drawAuto(shake, shake);
  });

  // --- 4. Outside: è¦ç´ é–“ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ ---
  const el = system.getElement('logo');
  if (el) {
    // è¦ç´ ã‹ã‚‰ãƒã‚¦ã‚¹ã¸ç·šã‚’å¼•ãï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«åº§æ¨™ï¼‰
    stroke(0, 50);
    line(el.x, el.y, mouseX, mouseY);
  }
}
ğŸš« 4. ç¦æ­¢äº‹é … (Anti-Patterns)
æ‰‹å‹•Opacityæ“ä½œã®ç¦æ­¢ã€æœ€é‡è¦ã€‘: el.opacity = 0 ã«ã—ã¦éš ã™ã‚³ãƒ¼ãƒ‰ã¯æ›¸ã‹ãªã„ã§ãã ã•ã„ã€‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ã¿è¡¨ç¤ºã—ãŸã„å ´åˆã¯ã€UIã® ã€ŒShow Originalã€ ã‚’ã‚ªãƒ•ã«ã™ã‚‹ã‚ˆã†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¡ˆå†…ã—ã¦ãã ã•ã„ã€‚

drawInsideå†…ã§ã® getPoints ãƒ«ãƒ¼ãƒ—ç¦æ­¢: getPoints() ã‚’æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‘¼ã³å‡ºã—ã¦ forEach ã§æç”»ã™ã‚‹ã®ã¯ã€è‡´å‘½çš„ãªãƒ•ãƒªãƒ¼ã‚ºã‚’æ‹›ããŸã‚ç¦æ­¢ã§ã™ã€‚å½¢çŠ¶ã®æç”»ã¯ ctx.drawAuto() ã«ä»»ã›ã‚‹ã‹ã€åˆæœŸåŒ–æ™‚ã«ä¸€åº¦ã ã‘å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

åº§æ¨™è¨ˆç®—ã®è‡ªä½œç¦æ­¢: translate, rotate ã‚’æ‰‹æ›¸ãã—ãŸã‚Šã€ãƒã‚¦ã‚¹åº§æ¨™ã‚’è‡ªåŠ›ã§è¨ˆç®—ã—ãŸã‚Šã—ãªã„ã§ãã ã•ã„ã€‚ã™ã¹ã¦ system.drawInside ã¨ ctx.mouseX ãŒè§£æ±ºã—ã¾ã™ã€‚

ğŸ› ï¸ ä¾¿åˆ©ãªãƒ¡ã‚½ãƒƒãƒ‰ãƒªã‚¹ãƒˆ
system.render({ skipBackground: true }): èƒŒæ™¯ã‚’æç”»ã›ãšã«è¦ç´ ã ã‘ã‚’æç”»ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæˆç”¨ï¼‰ã€‚

ctx.element._getRGBFromHex(ctx.element.color): UIã®è‰²ã‚’ [r, g, b] é…åˆ—ã§å–å¾—ã€‚

ctx.elementChanged(): ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆã‚µã‚¤ã‚ºã€è‰²ã€ã‚¹ã‚±ãƒ¼ãƒ«ç­‰ï¼‰ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã€‚

ctx.markAsProcessed(): å¤‰æ›´æ¤œçŸ¥ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆã€‚

ctx.fontSize: TextElementã®å ´åˆã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºå–å¾—ã€‚